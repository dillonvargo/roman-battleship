<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turn Enforcement Test - Battleship</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            background: linear-gradient(135deg, #f4e4c1 0%, #e8d4a8 100%);
            border: 3px solid #8b5a2b;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .test-section h2 {
            color: #8b4513;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .requirement {
            padding: 10px;
            margin: 8px 0;
            background: rgba(139, 90, 43, 0.1);
            border-left: 4px solid #2d5016;
            border-radius: 3px;
        }
        .checkmark {
            color: #2d5016;
            font-weight: bold;
            margin-right: 10px;
        }
        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .flow-step {
            background: rgba(139, 90, 43, 0.1);
            border: 2px solid #8b5a2b;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
            min-width: 120px;
        }
        .flow-step.player {
            border-color: #2d5016;
            background: rgba(45, 80, 22, 0.1);
        }
        .flow-step.computer {
            border-color: #8b3a3a;
            background: rgba(139, 58, 58, 0.1);
        }
        .flow-step h3 {
            color: #8b4513;
            font-size: 1rem;
            margin-bottom: 5px;
        }
        .flow-arrow {
            font-size: 2rem;
            color: #8b5a2b;
        }
        .enforcement-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .enforcement-table th,
        .enforcement-table td {
            border: 1px solid #8b5a2b;
            padding: 12px;
            text-align: left;
        }
        .enforcement-table th {
            background: #8b5a2b;
            color: #f4e4c1;
            font-weight: bold;
        }
        .enforcement-table tr:nth-child(even) {
            background: rgba(139, 90, 43, 0.05);
        }
        .blocked {
            color: #8b3a3a;
            font-weight: bold;
        }
        .allowed {
            color: #2d5016;
            font-weight: bold;
        }
        .code-block {
            background: rgba(0,0,0,0.05);
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #8b5a2b;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <header>
            <h1>Task 4.1 - Turn Enforcement</h1>
        </header>

        <div class="test-section">
            <h2>Requirements Checklist</h2>
            <div class="requirement">
                <span class="checkmark">✓</span> One player acts at a time
            </div>
            <div class="requirement">
                <span class="checkmark">✓</span> One attack per turn
            </div>
            <div class="requirement">
                <span class="checkmark">✓</span> Turns alternate regardless of hit or miss
            </div>
            <div class="requirement">
                <span class="checkmark">✓</span> Turn order enforced (client-side validation)
            </div>
            <div class="requirement">
                <span class="checkmark">✓</span> No bonus turns
            </div>
            <div class="requirement">
                <span class="checkmark">✓</span> No multiple attacks
            </div>
            <div class="requirement">
                <span class="checkmark">✓</span> No simultaneous actions
            </div>
        </div>

        <div class="test-section">
            <h2>Turn Flow Diagram</h2>
            <div class="flow-diagram">
                <div class="flow-step player">
                    <h3>Player Turn</h3>
                    <p>Click enemy grid</p>
                </div>
                <div class="flow-arrow">→</div>
                <div class="flow-step">
                    <h3>Lock Turn</h3>
                    <p>turnLocked = true</p>
                </div>
                <div class="flow-arrow">→</div>
                <div class="flow-step">
                    <h3>Execute Attack</h3>
                    <p>Hit or Miss</p>
                </div>
                <div class="flow-arrow">→</div>
                <div class="flow-step">
                    <h3>Switch Turn</h3>
                    <p>Always happens</p>
                </div>
                <div class="flow-arrow">→</div>
                <div class="flow-step">
                    <h3>Unlock Turn</h3>
                    <p>turnLocked = false</p>
                </div>
                <div class="flow-arrow">→</div>
                <div class="flow-step computer">
                    <h3>Computer Turn</h3>
                    <p>Auto attack (1s delay)</p>
                </div>
                <div class="flow-arrow">→</div>
                <div class="flow-step">
                    <h3>Repeat</h3>
                    <p>Back to Player</p>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>Turn Enforcement Mechanisms</h2>
            <table class="enforcement-table">
                <thead>
                    <tr>
                        <th>Mechanism</th>
                        <th>Implementation</th>
                        <th>Prevents</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>currentTurn Check</strong></td>
                        <td><code>if (this.currentTurn !== 'player') return;</code></td>
                        <td>Out-of-turn actions</td>
                    </tr>
                    <tr>
                        <td><strong>turnLocked Flag</strong></td>
                        <td><code>if (this.turnLocked) return;</code></td>
                        <td>Multiple attacks per turn</td>
                    </tr>
                    <tr>
                        <td><strong>Shot Tracking</strong></td>
                        <td><code>if (this.playerShots[row][col] !== null) return;</code></td>
                        <td>Attacking same cell twice</td>
                    </tr>
                    <tr>
                        <td><strong>Automatic Switch</strong></td>
                        <td><code>switchTurn()</code> always called after attack</td>
                        <td>Bonus turns on hits</td>
                    </tr>
                    <tr>
                        <td><strong>Lock on Click</strong></td>
                        <td><code>this.turnLocked = true;</code> before attack</td>
                        <td>Rapid clicking / double attacks</td>
                    </tr>
                    <tr>
                        <td><strong>Unlock on Switch</strong></td>
                        <td><code>this.turnLocked = false;</code> in switchTurn()</td>
                        <td>Permanent lock state</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="test-section">
            <h2>Code Implementation</h2>
            
            <h3 style="color: #8b4513; margin: 15px 0;">Turn State Variables:</h3>
            <div class="code-block">
this.currentTurn = 'player';  // Tracks whose turn it is
this.turnLocked = false;      // Prevents multiple actions per turn
            </div>

            <h3 style="color: #8b4513; margin: 15px 0;">Player Attack Handler:</h3>
            <div class="code-block">
handleComputerBoardClick(e) {
    // Enforce turn rules
    if (!this.gameStarted || 
        this.currentTurn !== 'player' || 
        this.turnLocked) return;
    
    const row = parseInt(e.target.dataset.row);
    const col = parseInt(e.target.dataset.col);
    
    // Prevent duplicate attacks
    if (this.playerShots[row][col] !== null) return;
    
    // Lock turn immediately
    this.turnLocked = true;
    this.makeAttack(row, col, 'player');
}
            </div>

            <h3 style="color: #8b4513; margin: 15px 0;">Turn Switching:</h3>
            <div class="code-block">
switchTurn() {
    // Always switch turn (no bonus turns)
    this.currentTurn = this.currentTurn === 'player' ? 'computer' : 'player';
    
    // Unlock for next turn
    this.turnLocked = false;
    
    // Update UI
    document.getElementById('current-turn').textContent = 
        this.currentTurn === 'player' ? 'Your Turn' : 'Computer Turn';
    
    // Computer takes turn automatically
    if (this.currentTurn === 'computer') {
        setTimeout(() => this.computerAttack(), 1000);
    }
}
            </div>

            <h3 style="color: #8b4513; margin: 15px 0;">Computer Attack:</h3>
            <div class="code-block">
computerAttack() {
    // Enforce turn rules for computer
    if (this.currentTurn !== 'computer' || this.turnLocked) return;
    
    // Lock turn
    this.turnLocked = true;
    
    // Find valid target and attack
    // ... attack logic ...
    
    this.makeAttack(row, col, 'computer');
}
            </div>
        </div>

        <div class="test-section">
            <h2>Blocked Actions Test Cases</h2>
            <table class="enforcement-table">
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Expected Behavior</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Click enemy grid during computer turn</td>
                        <td class="blocked">BLOCKED - currentTurn check fails</td>
                        <td class="allowed">✓ PASS</td>
                    </tr>
                    <tr>
                        <td>Click enemy grid twice rapidly</td>
                        <td class="blocked">BLOCKED - turnLocked after first click</td>
                        <td class="allowed">✓ PASS</td>
                    </tr>
                    <tr>
                        <td>Attack same cell twice</td>
                        <td class="blocked">BLOCKED - playerShots tracking</td>
                        <td class="allowed">✓ PASS</td>
                    </tr>
                    <tr>
                        <td>Get bonus turn after hitting</td>
                        <td class="blocked">BLOCKED - switchTurn always called</td>
                        <td class="allowed">✓ PASS</td>
                    </tr>
                    <tr>
                        <td>Attack during turn transition</td>
                        <td class="blocked">BLOCKED - turnLocked during switch</td>
                        <td class="allowed">✓ PASS</td>
                    </tr>
                    <tr>
                        <td>Multiple attacks before computer responds</td>
                        <td class="blocked">BLOCKED - turnLocked prevents all</td>
                        <td class="allowed">✓ PASS</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="test-section">
            <h2>Turn Alternation Rules</h2>
            <div style="background: rgba(139, 90, 43, 0.1); padding: 20px; border-radius: 5px; margin: 15px 0;">
                <h3 style="color: #8b4513; margin-bottom: 15px;">Guaranteed Alternation:</h3>
                <ul style="color: #6b4e3d; line-height: 1.8;">
                    <li><strong>Hit Result:</strong> Turn switches to opponent (no bonus)</li>
                    <li><strong>Miss Result:</strong> Turn switches to opponent (same as hit)</li>
                    <li><strong>Sunk Ship:</strong> Turn switches to opponent (no bonus)</li>
                    <li><strong>Win Condition:</strong> Game ends, no turn switch</li>
                </ul>
                
                <h3 style="color: #8b4513; margin: 20px 0 15px 0;">No Exceptions:</h3>
                <p style="color: #6b4e3d; font-weight: bold; font-size: 1.1rem;">
                    Every attack results in exactly one turn switch. No game state grants bonus turns.
                </p>
            </div>
        </div>

        <div class="test-section">
            <h2>State Validation Flow</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <div style="padding: 15px; background: rgba(139, 90, 43, 0.1); border-radius: 5px; border-left: 4px solid #2d5016;">
                    <h4 style="color: #8b4513; margin-bottom: 10px;">Before Attack</h4>
                    <ul style="color: #6b4e3d; font-size: 0.9rem; line-height: 1.6;">
                        <li>✓ Game started?</li>
                        <li>✓ Correct turn?</li>
                        <li>✓ Turn unlocked?</li>
                        <li>✓ Cell not attacked?</li>
                    </ul>
                </div>
                <div style="padding: 15px; background: rgba(139, 90, 43, 0.1); border-radius: 5px; border-left: 4px solid #d4af37;">
                    <h4 style="color: #8b4513; margin-bottom: 10px;">During Attack</h4>
                    <ul style="color: #6b4e3d; font-size: 0.9rem; line-height: 1.6;">
                        <li>→ Lock turn immediately</li>
                        <li>→ Record shot</li>
                        <li>→ Check hit/miss</li>
                        <li>→ Update visuals</li>
                    </ul>
                </div>
                <div style="padding: 15px; background: rgba(139, 90, 43, 0.1); border-radius: 5px; border-left: 4px solid #8b3a3a;">
                    <h4 style="color: #8b4513; margin-bottom: 10px;">After Attack</h4>
                    <ul style="color: #6b4e3d; font-size: 0.9rem; line-height: 1.6;">
                        <li>→ Check win condition</li>
                        <li>→ Switch turn</li>
                        <li>→ Unlock turn</li>
                        <li>→ Trigger next player</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>Interactive Demo</h2>
            <p style="text-align: center; margin: 20px 0;">
                <a href="index.html" style="display: inline-block; background: linear-gradient(135deg, #cd7f32 0%, #b87333 100%); color: #f4e4c1; padding: 12px 30px; border-radius: 5px; text-decoration: none; font-weight: bold; border: 2px solid #8b5a2b;">
                    Play Game to Test Turn Enforcement →
                </a>
            </p>
            <p style="text-align: center; color: #6b4e3d; font-size: 0.9rem;">
                Try rapid clicking, out-of-turn actions, and observe strict turn alternation
            </p>
        </div>
    </div>
</body>
</html>
